services:
  - type: web
    name: istqb-api
    runtime: node
    buildCommand: npm install && npm run build --workspace=packages/api
    startCommand: npm start --workspace=packages/api
    envVars:
      - key: NODE_ENV
        value: production
      - key: API_PORT
        value: 3001
    region: oregon
    plan: starter
    autoDeploy: true

  - type: web
    name: istqb-frontend
    runtime: node
    buildCommand: npm install && npm run build --workspace=packages/web
    startCommand: npm start --workspace=packages/web
    envVars:
      - key: NODE_ENV
        value: production
    region: oregon
    plan: starter
    autoDeploy: true

  # Cron Job gratuito para procesar recordatorios cada 5 minutos
  - type: cron
    name: istqb-reminder-scheduler
    runtime: node
    schedule: "*/5 * * * *"  # Cada 5 minutos
    buildCommand: npm install
    startCommand: node -e "const https=require('https');const data=JSON.stringify({});const options={hostname:'istqb-api.onrender.com',port:443,path:'/api/scheduler/reminders/process',method:'POST',headers:{'x-scheduler-key':process.env.SCHEDULER_API_KEY,'Content-Type':'application/json','Content-Length':data.length}};const req=https.request(options,res=>{let body='';res.on('data',chunk=>body+=chunk);res.on('end',()=>{console.log('Response:',body);process.exit(res.statusCode===200?0:1)})});req.on('error',e=>{console.error('Error:',e.message);process.exit(1)});req.write(data);req.end();"
    envVars:
      - key: NODE_ENV
        value: production
      - key: SCHEDULER_API_KEY
        sync: false  # Deber√°s configurar este valor manualmente en Render Dashboard
    region: oregon
    plan: free
